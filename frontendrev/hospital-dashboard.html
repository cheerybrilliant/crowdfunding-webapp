<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Dashboard - Cancer Patient Support Platform</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 0.5rem;
        }
        
        .verification-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .verification-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .verification-table th {
            background-color: #667eea;
            color: white;
            padding: 1rem;
            text-align: left;
        }
        
        .verification-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .verification-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #fff3e0;
            color: #f39c12;
        }
        
        .status-approved {
            background-color: #e8f5e9;
            color: #2ecc71;
        }
        
        .action-buttons button {
            margin: 0 0.3rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-approve {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-reject {
            background-color: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="index.html" class="logo">CancerCare</a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="campaigns.html">Campaigns</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="partner-hospitals.html">Partner Hospitals</a></li>
            <li><a href="about.html">About Us</a></li>
            <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" id="notificationBell" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-bell"></i> <!-- Font Awesome bell icon -->
        <span class="badge bg-danger notification-count" style="display:none;">0</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" id="notificationDropdown" aria-labelledby="notificationBell" style="max-height: 400px; overflow-y: auto; width: 350px;">
        <!-- Notifications appear here -->
    </ul>
</li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h1>Hospital Admin Dashboard</h1>
            <p>Yaoundé General Hospital - Centre Ville</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">12</div>
                <div class="stat-label">Pending Verifications</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">45</div>
                <div class="stat-label">Verified Patients</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">8</div>
                <div class="stat-label">Active Campaigns</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">Upcoming Events</div>
            </div>
        </div>

        <!-- Pending Verifications -->
        <h2 class="page-title">Pending Patient Verifications</h2>
        <div class="verification-table">
            <table id="verificationsTable">
                <thead>
                    <tr>
                        <th>Patient Name</th>
                        <th>Diagnosis</th>
                        <th>Submitted Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Verification rows will be added here by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Create Event Section -->
        <div class="card mt-2">
            <h2>Create New Health Event</h2>
            <form id="createEventForm" class="form">
                <div class="form-group">
                    <label for="eventTitle">Event Title</label>
                    <input type="text" id="eventTitle" required>
                </div>
                <div class="form-group">
                    <label for="eventDate">Event Date</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label for="eventType">Event Type</label>
                    <select id="eventType" required>
                        <option value="">Select type...</option>
                        <option value="Seminar">Seminar</option>
                        <option value="Health Gathering">Health Gathering</option>
                        <option value="Screening">Free Screening</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Create Event</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>CancerCare</h3>
                <p>Supporting cancer patients in Yaoundé through community-driven fundraising and health education.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="campaigns.html">Active Campaigns</a></li>
                    <li><a href="events.html">Health Events</a></li>
                    <li><a href="partner-hospitals.html">Partner Hospitals</a></li>
                    <li><a href="about.html">About Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Get Involved</h4>
                <ul>
                    <li><a href="donate.html">Make a Donation</a></li>
                    <li><a href="verification.html">Patient Verification</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contact Us</h4>
                <p style="font-size: 0.9rem; margin: 0.5rem 0;">
                    <strong>Phone:</strong><br>
                    +237 680 480 725<br>
                    +237 681 018 022
                </p>
                <p style="font-size: 0.9rem; margin-top: 1rem;">
                    Available Monday - Friday, 8AM - 5PM
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 CancerCare Platform. Created by six students dedicated to helping cancer patients.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Security: Check hospital authentication on page load
        window.addEventListener('load', function() {
            const session = validateHospitalSession();
            if (!session) {
                alert('Unauthorized access! Please login first.');
                window.location.href = 'hospital-login.html';
                return;
            }

            // Update dashboard header with hospital name
            const headerTitle = document.querySelector('.dashboard-header h1');
            if (headerTitle) {
                headerTitle.textContent = `Hospital Admin Dashboard - ${session.hospitalName}`;
            }
        });

        // Load pending verifications from localStorage
        function getPendingVerifications() {
            return JSON.parse(localStorage.getItem('verificationRequests') || '[]');
        }

        // Display verifications
        function displayVerifications() {
            const tbody = document.querySelector('#verificationsTable tbody');
            tbody.innerHTML = '';

            const pendingVerifications = getPendingVerifications().filter(v => v.status === 'pending');

            if (pendingVerifications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: #666;">No pending verifications</td></tr>';
                return;
            }

            pendingVerifications.forEach(verification => {
                const row = `
                    <tr>
                        <td>${verification.patientName}</td>
                        <td>${verification.diagnosis}</td>
                        <td>${new Date(verification.submittedDate).toLocaleDateString()}</td>
                        <td><span class="status-badge status-${verification.status}">${verification.status.toUpperCase()}</span></td>
                        <td class="action-buttons">
                            <button class="btn-approve" onclick="approveVerification('${verification.id}')">Approve</button>
                            <button class="btn-reject" onclick="rejectVerification('${verification.id}')">Reject</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Update pending count
            document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = pendingVerifications.length;
        }

        // Approve verification and create campaign
        function approveVerification(id) {
            const verificationRequests = getPendingVerifications();
            const verification = verificationRequests.find(v => v.id === id);

            if (verification) {
                // Update verification status
                verification.status = 'approved';
                verification.approvedDate = new Date().toISOString();
                localStorage.setItem('verificationRequests', JSON.stringify(verificationRequests));

                // Create new campaign
                const campaigns = loadCampaigns();
                const newCampaignId = campaigns.length > 0 ? Math.max(...campaigns.map(c => c.id)) + 1 : 1;

                const newCampaign = {
                    id: newCampaignId,
                    patientName: verification.patientName,
                    age: 0, // Will be updated when patient completes profile
                    patientType: 'adult',
                    story: `${verification.patientName} is fighting ${verification.diagnosis} and needs your support.`,
                    fullStory: `${verification.patientName} has been diagnosed with ${verification.diagnosis} and requires urgent medical treatment. The estimated treatment cost is ${formatCurrency(verification.treatmentCost)}. Your support will help provide the necessary medical care.`,
                    goalAmount: parseInt(verification.treatmentCost),
                    raisedAmount: 0,
                    image: 'patient-default.jpg',
                    verified: true,
                    verifiedBy: verification.hospitalId,
                    createdDate: new Date().toISOString()
                };

                campaigns.push(newCampaign);

                // Save campaigns to localStorage
                const secureData = {
                    campaigns: campaigns,
                    checksum: generateChecksum(campaigns)
                };
                localStorage.setItem('campaigns', JSON.stringify(secureData));

                // Update patient's verified status
                const userDatabase = getUserDatabase();
                if (userDatabase[verification.patientEmail]) {
                    userDatabase[verification.patientEmail].userData.verified = true;
                    userDatabase[verification.patientEmail].userData.campaignId = newCampaignId;
                    localStorage.setItem('userDatabase', JSON.stringify(userDatabase));
                }

                alert(`Patient ${verification.patientName} has been approved and verified!\nA new campaign has been created.`);
                displayVerifications();
            }
        }

        // Reject verification
        function rejectVerification(id) {
            const verificationRequests = getPendingVerifications();
            const verification = verificationRequests.find(v => v.id === id);

            if (verification) {
                const reason = prompt('Please provide a reason for rejection:');
                if (reason) {
                    verification.status = 'rejected';
                    verification.rejectedDate = new Date().toISOString();
                    verification.rejectionReason = reason;
                    localStorage.setItem('verificationRequests', JSON.stringify(verificationRequests));

                    alert(`Verification for ${verification.patientName} has been rejected.\nReason: ${reason}`);
                    displayVerifications();
                }
            }
        }

        // Handle create event form
        document.getElementById('createEventForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const type = document.getElementById('eventType').value;

            alert(`Event created successfully!\n\nTitle: ${title}\nDate: ${date}\nType: ${type}`);

            // Reset form
            this.reset();
        });

        // Load verifications when page loads
        window.addEventListener('load', displayVerifications);
    </script>
    <script src="api-client.js"></script>
    <script src="backend-integration.js"></script>
</body>
</html>
