<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Dashboard - Cancer Patient Support Platform</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 0.5rem;
        }
        
        .verification-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .verification-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .verification-table th {
            background-color: #667eea;
            color: white;
            padding: 1rem;
            text-align: left;
        }
        
        .verification-table td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .verification-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #fff3e0;
            color: #f39c12;
        }
        
        .status-approved {
            background-color: #e8f5e9;
            color: #2ecc71;
        }
        
        .action-buttons button {
            margin: 0 0.3rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-approve {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-reject {
            background-color: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="index.html" class="logo">CancerCare</a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="campaigns.html">Campaigns</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="partner-hospitals.html">Partner Hospitals</a></li>
            <li><a href="about.html">About Us</a></li>
            <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" id="notificationBell" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-bell"></i> <!-- Font Awesome bell icon -->
        <span class="badge bg-danger notification-count" style="display:none;">0</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" id="notificationDropdown" aria-labelledby="notificationBell" style="max-height: 400px; overflow-y: auto; width: 350px;">
        <!-- Notifications appear here -->
    </ul>
</li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h1>Hospital Admin Dashboard</h1>
            <p>Yaoundé General Hospital - Centre Ville</p>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">12</div>
                <div class="stat-label">Pending Verifications</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">45</div>
                <div class="stat-label">Verified Patients</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">8</div>
                <div class="stat-label">Active Campaigns</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">Upcoming Events</div>
            </div>
        </div>

        <!-- Pending Verifications -->
        <h2 class="page-title">Pending Patient Verifications</h2>
        <div class="verification-table">
            <table id="verificationsTable">
                <thead>
                    <tr>
                        <th>Patient Name</th>
                        <th>Diagnosis</th>
                        <th>Submitted Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Verification rows will be added here by JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Create Event Section -->
        <div class="card mt-2">
            <h2>Create New Health Event</h2>
            <form id="createEventForm" class="form">
                <div class="form-group">
                    <label for="eventTitle">Event Title</label>
                    <input type="text" id="eventTitle" required>
                </div>
                <div class="form-group">
                    <label for="eventDate">Event Date</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label for="eventType">Event Type</label>
                    <select id="eventType" required>
                        <option value="">Select type...</option>
                        <option value="Seminar">Seminar</option>
                        <option value="Health Gathering">Health Gathering</option>
                        <option value="Screening">Free Screening</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Create Event</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>CancerCare</h3>
                <p>Supporting cancer patients in Yaoundé through community-driven fundraising and health education.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="campaigns.html">Active Campaigns</a></li>
                    <li><a href="events.html">Health Events</a></li>
                    <li><a href="partner-hospitals.html">Partner Hospitals</a></li>
                    <li><a href="about.html">About Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Get Involved</h4>
                <ul>
                    <li><a href="donate.html">Make a Donation</a></li>
                    <li><a href="verification.html">Patient Verification</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contact Us</h4>
                <p style="font-size: 0.9rem; margin: 0.5rem 0;">
                    <strong>Phone:</strong><br>
                    +237 680 480 725<br>
                    +237 681 018 022
                </p>
                <p style="font-size: 0.9rem; margin-top: 1rem;">
                    Available Monday - Friday, 8AM - 5PM
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 CancerCare Platform. Created by six students dedicated to helping cancer patients.</p>
        </div>
    </footer>

    <script src="api-client.js"></script>
    <script src="script.js"></script>
    <script>
        // Security: Check hospital authentication on page load
        window.addEventListener('load', function() {
            const session = validateHospitalSession();
            if (!session) {
                alert('Unauthorized access! Please login first.');
                window.location.href = 'hospital-login.html';
                return;
            }

            // Update dashboard header with hospital name
            const headerTitle = document.querySelector('.dashboard-header h1');
            if (headerTitle) {
                headerTitle.textContent = `Hospital Admin Dashboard - ${session.hospitalName}`;
            }

            loadDashboardStats();
        });

        async function getPendingVerifications() {
            if (window.apiClient) {
                try {
                    const requests = await window.apiClient.getVerificationRequests();
                    return requests.filter(request => request.status === 'pending');
                } catch (error) {
                    console.error('Verification requests API error:', error);
                }
            }

            return JSON.parse(localStorage.getItem('verificationRequests') || '[]')
                .filter(request => request.status === 'pending');
        }

        // Display verifications
        async function displayVerifications() {
            const tbody = document.querySelector('#verificationsTable tbody');
            tbody.innerHTML = '';

            const pendingVerifications = await getPendingVerifications();

            if (pendingVerifications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: #666;">No pending verifications</td></tr>';
                return;
            }

            pendingVerifications.forEach(verification => {
                const details = verification.description || verification.campaignTitle || 'Medical verification';
                const row = `
                    <tr>
                        <td>${verification.patientName}</td>
                        <td>${details}</td>
                        <td>${new Date(verification.submittedDate).toLocaleDateString()}</td>
                        <td><span class="status-badge status-${verification.status}">${verification.status.toUpperCase()}</span></td>
                        <td class="action-buttons">
                            <button class="btn-approve" onclick="approveVerification('${verification.id}')">Approve</button>
                            <button class="btn-reject" onclick="rejectVerification('${verification.id}')">Reject</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Update pending count
            document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = pendingVerifications.length;
        }

        // Approve verification and create campaign
        async function approveVerification(id) {
            try {
                if (window.apiClient) {
                    await window.apiClient.approveVerificationRequest(id);
                }

                alert('Verification approved! Campaign created for this patient.');
                displayVerifications();
                loadDashboardStats();
            } catch (error) {
                showAlert(error.message || 'Failed to approve verification', 'error');
            }
        }

        // Reject verification
        async function rejectVerification(id) {
            const reason = prompt('Please provide a reason for rejection:');
            if (!reason) return;

            try {
                if (window.apiClient) {
                    await window.apiClient.rejectVerificationRequest(id);
                }
                alert('Verification rejected.');
                displayVerifications();
                loadDashboardStats();
            } catch (error) {
                showAlert(error.message || 'Failed to reject verification', 'error');
            }
        }

        // Handle create event form
        document.getElementById('createEventForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const type = document.getElementById('eventType').value;

            const session = validateHospitalSession();
            const location = session ? session.hospitalName : 'CancerCare Partner Hospital';

            try {
                await window.apiClient.createEvent({
                    title,
                    date,
                    location,
                    description: `${type} hosted by ${location}.`,
                    eventType: type,
                    needsFunding: true,
                    goalAmount: 0
                });
                alert(`Event created successfully!\n\nTitle: ${title}\nDate: ${date}\nType: ${type}`);
                loadDashboardStats();
            } catch (error) {
                showAlert(error.message || 'Failed to create event', 'error');
                return;
            }

            // Reset form
            this.reset();
        });

        async function loadDashboardStats() {
            const stats = document.querySelectorAll('.stat-card .stat-number');
            if (!stats.length) return;

            let pendingCount = 0;
            let verifiedCount = 0;
            let campaignCount = 0;
            let eventCount = 0;

            try {
                if (window.apiClient) {
                    const [requests, campaigns, events] = await Promise.all([
                        window.apiClient.getVerificationRequests(),
                        window.apiClient.getCampaigns(),
                        window.apiClient.getEvents()
                    ]);
                    pendingCount = requests.filter(req => req.status === 'pending').length;
                    verifiedCount = requests.filter(req => req.status === 'approved').length;
                    campaignCount = campaigns.length;
                    eventCount = events.length;
                }
            } catch (error) {
                console.error('Dashboard stats error:', error);
            }

            stats[0].textContent = pendingCount;
            stats[1].textContent = verifiedCount;
            stats[2].textContent = campaignCount;
            stats[3].textContent = eventCount;
        }

        // Load verifications when page loads
        window.addEventListener('load', displayVerifications);
    </script>
    <script src="backend-integration.js"></script>
</body>
</html>
