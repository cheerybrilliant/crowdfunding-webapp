<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Details - Cancer Patient Support Platform</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="index.html" class="logo">CancerCare</a>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="campaigns.html">Campaigns</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="partner-hospitals.html">Partner Hospitals</a></li>
            <li><a href="about.html">About Us</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="create-account.html">Create Account</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div id="campaignDetails">
            <!-- Campaign details will be loaded here by JavaScript -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2026 CancerCare Platform. Created by six students dedicated to helping cancer patients.</p>
    </footer>

    <script src="script.js"></script>
    <script>
        // Get campaign ID from URL
        function getCampaignIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }
        
        // Display campaign details
        function displayCampaignDetails() {
            const campaignId = getCampaignIdFromURL();
            
            if (!campaignId) {
                document.getElementById('campaignDetails').innerHTML = `
                    <div class="card">
                        <h2>Campaign Not Found</h2>
                        <p>The campaign you are looking for does not exist.</p>
                        <a href="campaigns.html" class="btn btn-primary">View All Campaigns</a>
                    </div>
                `;
                return;
            }
            
            const campaigns = loadCampaigns();
            const campaign = campaigns.find((item) => String(item.id) === String(campaignId));
            
            if (!campaign) {
                document.getElementById('campaignDetails').innerHTML = `
                    <div class="card">
                        <h2>Campaign Not Found</h2>
                        <p>The campaign you are looking for does not exist.</p>
                        <a href="campaigns.html" class="btn btn-primary">View All Campaigns</a>
                    </div>
                `;
                return;
            }
            
            // Calculate progress percentage
            const percentage = ((campaign.raisedAmount / campaign.goalAmount) * 100).toFixed(1);

            // Check if campaign has any donations
            const hasNoDonations = campaign.raisedAmount === 0;

            // Get stored patient photo from localStorage
            const storedPhoto = localStorage.getItem(`patientPhoto_${campaign.id}`);

            // Display campaign details
            document.getElementById('campaignDetails').innerHTML = `
                <h1 class="page-title">${campaign.patientName}</h1>

                <div class="card">
                    ${campaign.verified ? '<p style="color: #2ecc71; font-weight: bold;">Verified Patient</p>' : ''}

                    <!-- Patient Photo Section with Upload -->
                    <div style="background-color: #f0f0f0; padding: 2rem; border-radius: 10px; text-align: center; margin: 1rem 0; position: relative;">
                        ${storedPhoto ?
                            `<img id="patientPhoto" src="${storedPhoto}" alt="Patient Photo" style="max-width: 100%; max-height: 400px; border-radius: 10px; margin-bottom: 1rem;">` :
                            `<div id="patientPhoto" style="padding: 3rem;">
                                <p style="color: #666; font-style: italic; font-size: 1.2rem;">No Photo Uploaded</p>
                                <p style="color: #999; font-size: 0.9rem;">Upload a patient photo below</p>
                            </div>`
                        }

                        <!-- Photo Upload Section -->
                        <div style="margin-top: 1rem;">
                            <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                            <button onclick="document.getElementById('photoUpload').click()" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.5rem 1.5rem;">
                                ${storedPhoto ? 'Change Photo' : 'Upload Patient Photo'}
                            </button>
                            ${storedPhoto ?
                                `<button onclick="removePatientPhoto(${campaign.id})" class="btn btn-secondary" style="font-size: 0.9rem; padding: 0.5rem 1.5rem; margin-left: 0.5rem;">
                                    Remove Photo
                                </button>` : ''
                            }
                        </div>
                    </div>

                    <h2>Patient's Story</h2>
                    <p style="line-height: 1.8; text-align: justify;">${campaign.fullStory}</p>

                    <hr style="margin: 2rem 0; border: none; border-top: 1px solid #ddd;">

                    <h2>Funding Details</h2>
                    <div style="background-color: #f9f9f9; padding: 1.5rem; border-radius: 10px;">
                        <p><strong>Target Amount:</strong> ${formatCurrency(campaign.goalAmount)}</p>
                        <p><strong>Amount Raised:</strong> ${formatCurrency(campaign.raisedAmount)}</p>
                        <p><strong>Remaining:</strong> ${formatCurrency(campaign.goalAmount - campaign.raisedAmount)}</p>

                        <div class="progress-bar" style="margin: 1.5rem 0;">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                        <p style="text-align: center; font-size: 1.2rem; font-weight: bold; color: ${hasNoDonations ? '#e74c3c' : '#2ecc71'};">
                            ${percentage}% funded
                        </p>
                    </div>

                    <div style="text-align: center; margin-top: 2rem;">
                        ${hasNoDonations ?
                            `<a href="donate.html?campaign=${campaign.id}" class="btn btn-secondary" style="font-size: 1.2rem; padding: 1rem 3rem; background-color: var(--accent-coral); border-color: var(--accent-coral); color: #fff;">
                                Be the First to Donate!
                            </a>
                            <p style="margin-top: 1rem; color: #e74c3c; font-weight: bold;">No donations yet. Be the first to help ${campaign.patientName}!</p>` :
                            `<a href="donate.html?campaign=${campaign.id}" class="btn btn-secondary" style="font-size: 1.2rem; padding: 1rem 3rem;">
                                Donate Now
                            </a>`
                        }
                    </div>

                    <div style="margin-top: 2rem;">
                        <a href="campaigns.html" class="btn btn-primary">‚Üê Back to All Campaigns</a>
                    </div>
                </div>
            `;

            // Add event listener for photo upload
            document.getElementById('photoUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        showAlert('Please select an image file', 'error');
                        return;
                    }

                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showAlert('Image must be less than 5MB', 'error');
                        return;
                    }

                    // Read and store the image
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        localStorage.setItem(`patientPhoto_${campaign.id}`, event.target.result);
                        showAlert('Patient photo uploaded successfully!', 'success');
                        // Reload the page to show the new photo
                        displayCampaignDetails();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Function to remove patient photo
        function removePatientPhoto(campaignId) {
            if (confirm('Are you sure you want to remove this photo?')) {
                localStorage.removeItem(`patientPhoto_${campaignId}`);
                showAlert('Photo removed successfully', 'success');
                displayCampaignDetails();
            }
        }
        
        // Load campaign details when page loads
        window.addEventListener('load', displayCampaignDetails);
    </script>
</body>
</html>

