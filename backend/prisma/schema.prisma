generator client {
  provider = "prisma-client-js"
}
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  fullName         String
  email            String   @unique
  phone            String
  passwordHash     String
  accountType      String   // donor | patient
  verified         Boolean  @default(false)

  // ── One patient → can have one campaign ──
  campaign         Campaign? @relation("PatientToCampaign")
  campaignId       String?   @unique @db.ObjectId

  donations        Donation[]

  registrationDate DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Hospital {
  id                   String   @id @default(auto()) @map("_id") @db.ObjectId
  hospitalId           String   @unique
  hospitalName         String
  address              String
  phone                String
  adminName            String
  adminEmail           String   @unique
  passwordHash         String
  status               String   @default("pending")
  services             String?
  registeredDate       DateTime @default(now())

  verificationRequests VerificationRequest[]

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Campaign {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  description  String
  goalAmount   Float
  raisedAmount Float    @default(0)
  patientName  String
  patientAge   Int?
  hospitalName String
  photo        String?
campaignId     String
patientId    String? @unique @db.ObjectId
  // ── One campaign belongs to one patient ──
  patient      User?      @relation("CampaignToPatient", fields:[patientId], references: [id])
  

  donations    Donation[]

  creationDate DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Event {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  date         DateTime
  location     String
  description  String
  raisedAmount Float    @default(0)

  donations    Donation[]

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Donation {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  amount        Float
  donorName     String   @default("Anonymous")
  paymentMethod String   // mtn, orange, paystack, bank
  reference     String?  // MTN or Paystack ref
  requestId     String?  // MTN request ID
  status        String   @default("pending")
  message       String?
  donorPhone    String?

  donations    Donation[]

  campaign      Campaign? @relation(fields: [campaignId], references: [id])
  campaignId    String?   @db.ObjectId

  event         Event?    @relation(fields: [eventId], references: [id])
  eventId       String?   @db.ObjectId

  

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model VerificationRequest {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  patientName     String
  patientEmail    String
  diagnosis       String
  treatmentCost   Float
  status          String   @default("pending")
  rejectionReason String?

  submittedDate   DateTime @default(now())

  hospital        Hospital @relation(fields: [hospitalId], references: [id])
  hospitalId      String   @db.ObjectId

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}